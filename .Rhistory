library(RCurl)
x <- getURL("https://raw.githubusercontent.com/eea-uba/EEA-2025/refs/heads/main/clase%209/cardio_train.csv")
y <- read.csv(text = x)
y
library(RCurl)
x <- getURL("https://raw.githubusercontent.com/eea-uba/EEA-2025/refs/heads/main/clase%209/cardio_train.csv")
y <- read.csv(text = x, sep = ";")
y
library(RCurl)
x <- getURL("https://raw.githubusercontent.com/eea-uba/EEA-2025/refs/heads/main/clase%209/cardio_train.csv")
df <- read.csv(text = x, sep = ";")
df
# Checking any missing values
colSums(is.na(df))
# Checking for any duplicate values in dataset
sum(duplicated(df))
glimpse(df)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
# import libraries
library(tidyverse)
library(tidymodels)
library(modelr)
library(GGally)
library(pROC)
library(cowplot)
library(OneR)
library(rlang)
library(caret)
library(RCurl)
set.seed(15)
glimpse(df)
glimpse(df)
df %>%
mutate(age_years = age / 365)
df %>%
mutate(age_years = round( age / 365), digits=0)
df %>%
mutate(age_years = round( age / 365, digits=0))
ggplot(df, aes(x=age_years)) + geom_histogram()
df <- df %>%
mutate(age_years = round( age / 365, digits=0))
ggplot(df, aes(x=age_years)) + geom_histogram()
ggplot(df, aes(x=age_years)) + geom_boxplot()
p <- ggplot(df, aes(x=age_years)) + geom_histogram(color="black", fill="white")
p+ geom_vline(aes(xintercept=mean(weight)),
color="blue", linetype="dashed", size=1)
p <- ggplot(df, aes(x=age_years)) + geom_histogram(color="black", fill="white",bins = 40)
p+ geom_vline(aes(xintercept=mean(weight)),
color="blue", linetype="dashed", size=1)
df <- df %>%
mutate(age_years = int(round( age / 365, digits=0)))
p <- ggplot(df, aes(x=age_years)) + geom_histogram(color="black", fill="white",bins = 40)
p+ geom_vline(aes(xintercept=mean(weight)),
color="blue", linetype="dashed", size=1)
p <- ggplot(df, aes(x=age_years)) + geom_histogram(color="black", fill="white",bins = 40)
p+ geom_vline(aes(xintercept=mean(age_years)),
color="blue", linetype="dashed", size=1)
p <- ggplot(df, aes(x=age_years)) + geom_histogram(color="black", fill="white",bins = 20)
p+ geom_vline(aes(xintercept=mean(age_years)),
color="blue", linetype="dashed", size=1)
p <- ggplot(df, aes(x=age_years)) + geom_histogram(color="black", fill="white",bins = 20)
p+ geom_vline(aes(xintercept=mean(age_years)),
color="red", linetype="dashed", size=1)
ggplot(df, aes(x=age_years, color=gender)) +
geom_histogram(fill="white")
ggplot(df, aes(x=age_years, color=gender)) +
geom_histogram(fill="white", position="dodge")+
theme(legend.position="top")
ggplot(df, aes(x=age_years, color=gender)) +
geom_histogram( position="dodge")+
theme(legend.position="top")
ggplot(df, aes(x=age_years, color=gender)) +
geom_histogram( position="dodge", bins=20)+
theme(legend.position="top")
df$gender<- as.factor(df$gender)
ggplot(df, aes(x=age_years, color=gender)) +
geom_histogram( position="dodge", bins=20)+
theme(legend.position="top")
ggplot(df, aes(x=age_years, color=gender)) +
geom_histogram( fill="white",position="dodge", bins=20)+
theme(legend.position="top")
pie_data <- df %>%
count(gender) %>%
mutate(percentage = n / sum(n))
pie_data <- df %>%
count(gender) %>%
mutate(percentage = n / sum(n))
ggplot(pie_data, aes(x = "", y = percentage, fill = gender)) +
geom_col(width = 1, color = "white") + # Create stacked bars
coord_polar("y", start = 0) + # Transform to pie chart
theme_void() + # Remove background, grid, and axis labels
geom_text(aes(label = scales::percent(percentage)),
position = position_stack(vjust = 0.5),
color = "black") + # Add percentage labels
labs(title = "Distribution of Categories") # Add a title
pie_data <- df %>%
count(gender) %>%
mutate(percentage = n / sum(n))
ggplot(pie_data, aes(x = "", y = percentage, fill = gender)) +
geom_col(width = 1, color = "white") +
coord_polar("y", start = 0) +
theme_void() +
geom_text(aes(label = scales::percent(percentage)),
position = position_stack(vjust = 0.5),
color = "black") +
labs(title = "Distribution of Gender")
ggplot(df, aes(x=height)) +
geom_boxplot()
View(df)
df %>% filter (ap_hi > 120 & ap_hi < 90)
df %>% filter (ap_hi > 120 )
df %>% filter (ap_hi > 120 | ap_hi < 90)
df %>% filter (ap_hi > 130 | ap_hi < 90)
df %>% filter (ap_hi > 140 | ap_hi < 90)
df %>% filter (ap_hi > 160 | ap_hi < 90)
df %>% filter (ap_hi > 200 | ap_hi < 90)
df %>% filter (ap_hi > 190 | ap_hi < 90)
df %>% filter (api_lo > 150 | api_lo < 40)
df %>% filter (ap_lo > 150 | ap_lo < 40)
df %>% filter (ap_lo > 150 | ap_lo < 40)
%>% filter (ap_hi > 190 | ap_hi < 90)
df %>% filter (ap_lo > 150 | ap_lo < 40) %>% filter (ap_hi > 190 | ap_hi < 90)
df %>% filter (ap_hi > 190 | ap_hi < 90 | ap_lo > 150 | ap_lo < 40)
ggplot(df %>% filter (height > 100), aes(x=height)) +
geom_boxplot()
ggplot(df %>% filter (height > 100 | height < 200), aes(x=height)) +
geom_boxplot()
df %>% filter (height > 100 | height < 200)
df %>% filter ( height > 200)
df %>% filter (height > 100 | height < 200)
df %>% filter (height > 100 & height < 200)
ggplot(df %>% filter (height > 100 & height < 200), aes(x=height)) +
geom_boxplot()
ggplot(df, aes(x=weight)) +
geom_boxplot()
ggplot(df %>% filter (weight <50), aes(x=weight)) +
geom_boxplot()
df %>% filter (weight <50)
df %>% filter (weight <40)
df %>% filter (weight <30)
df %>% filter (weight <35)
df %>% filter (weight <35 | weight > 150)
df %>% filter (weight <35 | weight > 170)
df %>% filter (weight > 170)
df %>% filter (weight <35)
ggplot(df %>% filter (weight > 35), aes(x=weight)) +
geom_boxplot()
df %>% filter (height > 100 & height < 200) # filter the height
%>% filter (ap_hi < 190 | ap_hi > 90 | ap_lo < 150 | ap_lo > 40)#filter the diastolic and sistolic blood pressure
df %>% filter (height > 100 & height < 200)%>% # filter the height
filter (ap_hi < 190 | ap_hi > 90 | ap_lo < 150 | ap_lo > 40)%>% #filter the diastolic and sistolic blood pressure
filter (weight > 35)#filter the weight
df %>% filter (height > 100 & height < 200)%>% # filter the height
filter (ap_hi < 190 | ap_hi > 90 | ap_lo < 150 | ap_lo > 40)%>% #filter the diastolic and sistolic blood pressure
filter (weight > 40)#filter the weight
df %>%
filter(
height > 100 & height < 200,      # keep only physiologically plausible height values (in cm)
ap_hi >= 90 & ap_hi <= 190,       # keep systolic blood pressure within realistic clinical range
ap_lo >= 40 & ap_lo <= 150,       # keep diastolic blood pressure within realistic clinical range
ap_hi > ap_lo,                    # ensure systolic pressure is greater than diastolic pressure (physiological rule)
weight > 40                       # keep only plausible patient weight values (in kg)
)
df %>%
filter(
height > 100 & height < 200,      # keep only physiologically plausible height values (in cm)
ap_hi >= 90 & ap_hi <= 190,       # keep systolic blood pressure within realistic clinical range
ap_lo >= 40 & ap_lo <= 150,       # keep diastolic blood pressure within realistic clinical range
ap_hi > ap_lo,                    # ensure systolic pressure is greater than diastolic pressure (physiological rule)
weight > 40                       # keep only plausible patient weight values (in kg)
) %>%
select(-id, -age)
df_clean <- df %>%
filter(
height > 100 & height < 200,      # keep only physiologically plausible height values (in cm)
ap_hi >= 90 & ap_hi <= 190,       # keep systolic blood pressure within realistic clinical range
ap_lo >= 40 & ap_lo <= 150,       # keep diastolic blood pressure within realistic clinical range
ap_hi > ap_lo,                    # ensure systolic pressure is greater than diastolic pressure (physiological rule)
weight > 40                       # keep only plausible patient weight values (in kg)
) %>%
select(-id, -age)
df_clean %>%
group_by(cardio) %>%
summarise(cnt = n()) %>%
mutate(freq = round(cnt / sum(cnt), 2))
df_split <- initial_split(df_clean,
prop = 0.8)
train<- df_split %>%
training()
test <- df_split %>%
testing()
View(train)
# calculamos la distribución de clase en cada dataset
train_ <- train %>%
group_by(cardio) %>%
summarise(numero_casos=n()) %>%
mutate(prop = round(prop.table(numero_casos)*100,2))
test_ <- test %>%
group_by(cardio) %>%
summarise(numero_casos=n()) %>%
mutate(prop = round(prop.table(numero_casos)*100,2))
# armamos tabla conjunta para graficar
distrib = cbind(rbind(train_, test_), dataset = c("train", "train", "test", "test"))
# graficamos las distribuciones
ggplot(distrib, aes(x = cardio, y = prop, fill = factor(cardio), label = prop)) +
geom_bar(stat="identity", position = "dodge") + facet_wrap(~ dataset) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(x = "", y = "Proporción en %", title = "Proporción de cardio por dataset") +
guides(fill=guide_legend(title="cardio"))+
theme_bw() +
scale_fill_brewer(palette="Set2")
# modelo de regresión logística
glm1 <- glm(data = train,
cardio ~ .,
family = 'binomial')
# veo los resultados
tidy(glm1)
1 - (glm1$deviance / glm1$null.deviance)
glimpe(df_clean)
glimpse(df_clean)
df_clean <- df %>%
filter(
height > 100 & height < 200,      # keep only physiologically plausible height values (in cm)
ap_hi >= 90 & ap_hi <= 190,       # keep systolic blood pressure within realistic clinical range
ap_lo >= 40 & ap_lo <= 150,       # keep diastolic blood pressure within realistic clinical range
ap_hi > ap_lo,                    # ensure systolic pressure is greater than diastolic pressure (physiological rule)
weight > 40                       # keep only plausible patient weight values (in kg)
) %>%
select(-id, -age)
df_clean$ap_hi <- as.factor(df_clean$ap_hi)
df_clean$ap_lo <- as.factor(df_clean$ap_lo)
df_clean$cholesterol <- as.factor(df_clean$cholesterol)
df_clean$gluc <- as.factor(df_clean$gluc)
df_clean$smoke <- as.factor(df_clean$smoke)
df_clean$alco <- as.factor(df_clean$alco)
df_clean$aactive <- as.factor(df_clean$active)
df_clean$cardio <- as.factor(df_clean$cardio)
df_clean %>%
group_by(cardio) %>%
summarise(cnt = n()) %>%
mutate(freq = round(cnt / sum(cnt), 2))
df_split <- initial_split(df_clean,
prop = 0.8)
train<- df_split %>%
training()
test <- df_split %>%
testing()
# calculamos la distribución de clase en cada dataset
train_ <- train %>%
group_by(cardio) %>%
summarise(numero_casos=n()) %>%
mutate(prop = round(prop.table(numero_casos)*100,2))
test_ <- test %>%
group_by(cardio) %>%
summarise(numero_casos=n()) %>%
mutate(prop = round(prop.table(numero_casos)*100,2))
# armamos tabla conjunta para graficar
distrib = cbind(rbind(train_, test_), dataset = c("train", "train", "test", "test"))
# graficamos las distribuciones
ggplot(distrib, aes(x = cardio, y = prop, fill = factor(cardio), label = prop)) +
geom_bar(stat="identity", position = "dodge") + facet_wrap(~ dataset) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(x = "", y = "Proporción en %", title = "Proporción de cardio por dataset") +
guides(fill=guide_legend(title="cardio"))+
theme_bw() +
scale_fill_brewer(palette="Set2")
# modelo de regresión logística
glm1 <- glm(data = train,
cardio ~ .,
family = 'binomial')
# veo los resultados
tidy(glm1)
View(df_clean)
df_clean <- df %>%
filter(
height > 100 & height < 200,      # keep only physiologically plausible height values (in cm)
ap_hi >= 90 & ap_hi <= 190,       # keep systolic blood pressure within realistic clinical range
ap_lo >= 40 & ap_lo <= 150,       # keep diastolic blood pressure within realistic clinical range
ap_hi > ap_lo,                    # ensure systolic pressure is greater than diastolic pressure (physiological rule)
weight > 40                       # keep only plausible patient weight values (in kg)
) %>%
select(-id, -age)
df_clean$cholesterol <- as.factor(df_clean$cholesterol)
df_clean$gluc <- as.factor(df_clean$gluc)
df_clean$smoke <- as.factor(df_clean$smoke)
df_clean$alco <- as.factor(df_clean$alco)
df_clean$aactive <- as.factor(df_clean$active)
df_clean$cardio <- as.factor(df_clean$cardio)
View(df_clean)
df_clean <- df %>%
filter(
height > 100 & height < 200,      # keep only physiologically plausible height values (in cm)
ap_hi >= 90 & ap_hi <= 190,       # keep systolic blood pressure within realistic clinical range
ap_lo >= 40 & ap_lo <= 150,       # keep diastolic blood pressure within realistic clinical range
ap_hi > ap_lo,                    # ensure systolic pressure is greater than diastolic pressure (physiological rule)
weight > 40                       # keep only plausible patient weight values (in kg)
) %>%
select(-id, -age)
df_clean$cholesterol <- as.factor(df_clean$cholesterol)
df_clean$gluc <- as.factor(df_clean$gluc)
df_clean$smoke <- as.factor(df_clean$smoke)
df_clean$alco <- as.factor(df_clean$alco)
df_clean$active <- as.factor(df_clean$active)
df_clean$cardio <- as.factor(df_clean$cardio)
df_split <- initial_split(df_clean,
prop = 0.8)
train<- df_split %>%
training()
test <- df_split %>%
testing()
# calculamos la distribución de clase en cada dataset
train_ <- train %>%
group_by(cardio) %>%
summarise(numero_casos=n()) %>%
mutate(prop = round(prop.table(numero_casos)*100,2))
test_ <- test %>%
group_by(cardio) %>%
summarise(numero_casos=n()) %>%
mutate(prop = round(prop.table(numero_casos)*100,2))
# armamos tabla conjunta para graficar
distrib = cbind(rbind(train_, test_), dataset = c("train", "train", "test", "test"))
# graficamos las distribuciones
ggplot(distrib, aes(x = cardio, y = prop, fill = factor(cardio), label = prop)) +
geom_bar(stat="identity", position = "dodge") + facet_wrap(~ dataset) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(x = "", y = "Proporción en %", title = "Proporción de cardio por dataset") +
guides(fill=guide_legend(title="cardio"))+
theme_bw() +
scale_fill_brewer(palette="Set2")
# modelo de regresión logística
glm1 <- glm(data = train,
cardio ~ .,
family = 'binomial')
# veo los resultados
tidy(glm1)
1 - (glm1$deviance / glm1$null.deviance)
1 - (glm1$deviance / glm1$null.deviance)
df_clean <- df %>%
filter(
height > 100 & height < 200,      # keep only physiologically plausible height values (in cm)
ap_hi >= 90 & ap_hi <= 190,       # keep systolic blood pressure within realistic clinical range
ap_lo >= 40 & ap_lo <= 150,       # keep diastolic blood pressure within realistic clinical range
ap_hi > ap_lo,                    # ensure systolic pressure is greater than diastolic pressure (physiological rule)
weight > 40                       # keep only plausible patient weight values (in kg)
) %>%
select(-id, -age)
df_clean$cholesterol <- as.factor(df_clean$cholesterol)
df_clean$gluc <- as.factor(df_clean$gluc)
df_clean$smoke <- as.factor(df_clean$smoke)
df_clean$alco <- as.factor(df_clean$alco)
df_clean$active <- as.factor(df_clean$active)
df_clean$cardio <- as.factor(df_clean$cardio)
df_clean_sc <- df_clean  %>%
mutate(
across(where(is.numeric), ~ scale(.)[,1])
)
View(df_clean_sc)
df_clean <- df %>%
filter(
height > 100 & height < 200,      # keep only physiologically plausible height values (in cm)
ap_hi >= 90 & ap_hi <= 190,       # keep systolic blood pressure within realistic clinical range
ap_lo >= 40 & ap_lo <= 150,       # keep diastolic blood pressure within realistic clinical range
ap_hi > ap_lo,                    # ensure systolic pressure is greater than diastolic pressure (physiological rule)
weight > 40                       # keep only plausible patient weight values (in kg)
) %>%
select(-id, -age)
df_clean$cholesterol <- as.factor(df_clean$cholesterol)
df_clean$gluc <- as.factor(df_clean$gluc)
df_clean$smoke <- as.factor(df_clean$smoke)
df_clean$alco <- as.factor(df_clean$alco)
df_clean$active <- as.factor(df_clean$active)
df_clean$cardio <- as.factor(df_clean$cardio)
df_split <- initial_split(df_clean,
prop = 0.8)
train<- df_split %>%
training()
test <- df_split %>%
testing()
train_sc <- train  %>%
mutate(
across(where(is.numeric), ~ scale(.)[,1])
)
# modelo de regresión logística
glm1 <- glm(data = train_sc,
cardio ~ .,
family = 'binomial')
# veo los resultados
tidy(glm1)
1 - (glm1$deviance / glm1$null.deviance)
View(train_sc)
df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo)
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo))+geom_histogram()
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi))+geom_histogram()
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi), bins= 20)+geom_histogram()
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi), bins= 30)+geom_histogram()
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi), bins= 5)+geom_histogram()
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi))+geom_histogram()
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi), binwidth = 10)+geom_histogram()
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi), binwidth = 10, bins=40)+geom_histogram()
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi), binwidth = 5, bins=40)+geom_histogram()
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi), binwidth = 15, bins=40)+geom_histogram()
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi), binwidth = 5)+geom_histogram()
length(unique(df$ap_hi))
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi))+geom_histogram(binwidth = 5)
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi))+geom_histogram(binwidth = 10)
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi))+geom_histogram(binwidth = 7)
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi))+geom_histogram(binwidth = 10)
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi))+geom_histogram(binwidth = 9)
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi))+geom_histogram(binwidth = 10, bins=40)
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi))+geom_histogram(bins=40)
ggplot (df %>% filter (ap_hi >= 90 & ap_hi <= 190,
ap_lo >= 40 & ap_lo <= 150,
ap_hi > ap_lo), aes(x=ap_hi))+geom_histogram(binwidth = 10)
